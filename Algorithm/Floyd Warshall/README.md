# Floyd Warshall

> 변의 가중치가 음이거나 양인 가중 그래프에서 최단 경로들을 찾는 알고리즘

**'모든 정점'에서 '모든 정점'으로의 최단 경로 구하고 싶을 때 사용하는 알고리즘**

---

## 핵심 아이디어

> '거쳐가는 정점'을 기준으로 최단 거리를 구하는 것

- 모든 정점 쌍 최단경로(all-pairs shortest paths) 를 구함

- **동적 계획법(DP) 기반** : **중간에 사용할 수 있는 정점 집합을 점점 확장하면서 최단거리를 갱신**

- 음수 간선을 허용하지만, 음수 사이클이 존재하면 `dist[i][i] < 0` 로 탐지 가능

---

## 알고리즘 단계

```
// 의사코드
for i in 1..V:
    for j in 1..V:
        if i == j: dist[i][j] = 0
        else if edge(i,j) exists: dist[i][j] = w(i,j)
        else dist[i][j] = INF

for k in 1..V:
    for i in 1..V:
        for j in 1..V:
            if dist[i][k] + dist[k][j] < dist[i][j]:
                dist[i][j] = dist[i][k] + dist[k][j]
```

1. 초기: `dist[i][j] = w(i,j)` (직접 간선 가중치), `dist[i][i] = 0`

2. 세 중첩 루프: `for k in V: for i in V: for j in V: dist[i][j] = min(dist[i][j], dist[i][k] + dist[k][j])`

3. `k`는 **“중간에 허용하는 정점 집합”** 을 확장하는 역할

---

## 시간/공간복잡도

- 시간: `O(V^3)`

- 공간: `O(V^2)` (경로 복원 위해 `next` 배열 추가 가능)

---

## 알면 좋은 것들

### 구현 팁 / 주의사항

- `V`(정점 수)가 `400` 이상이면 `O(V^3)`이 부담스러움

- 음수 간선 허용 -> 음수 사이클 여부를 `dist[v][v] < 0` 로 확인

- 모든 쌍 최단거리가 필요할 때 사용

---

### 자주 나오는 유형

#### 모든 쌍 최단거리 직접 적용

*모든 도시 쌍 간 최소 비용 표를 만들고 여러 쿼리를 빠르게 답해야 하는 경우*

- 풀이 아이디어: 플로이드-워셜 한 번으로 `dist` 채워두고 각 쿼리 `O(1)` 응답

---

#### 중간 정점을 반드시 거쳐야 하는 경우 / 특정 경로 금지

*`A->B->C` 의 형태에서 `B`를 반드시 거쳐야 할 때 최단거리(`A->B + B->C`)* or *특정 간선을 사용하지 못하게 할 때*

- 풀이 아이디어: 플로이드로 모든 쌍 계산 후 조합 또는 플로이드 단계에서 특정 간선을 매우 큰 값으로 세팅해서 배제

---

#### 음수 간선 / 음수 사이클 검사

*도로 네트워크에 감면(음의 가중치)이 존재하고, 음수 사이클 여부를 검사해야 할 때*

- 풀이 아이디어: 플로이드 실행 후 `dist[i][i] < 0` 이면 음수 사이클 존재 (경로 길이 무한히 작아짐)

---

## 문제

- [Programmers - 합승 택시 요금](https://school.programmers.co.kr/learn/courses/30/lessons/72413)

- [Programmers - 순위](https://school.programmers.co.kr/learn/courses/30/lessons/49191)

## 참고

- [블로그 참고 - 플로이드 와샬 알고리즘(안경잡이개발자)](https://m.blog.naver.com/ndb796/221234427842?recommendTrackingCode=2)